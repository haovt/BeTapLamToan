<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>T·∫≠p L√†m To√°n Cho B√©</title>

  <style>
/* ====== BASE ====== */
body {
  margin: 0;
  font-family: "Comic Sans MS", system-ui, sans-serif;
  background: #fff0f6;
}

/* ====== TABS ====== */
.tabs {
  display: flex;
  background: #ff9ac4;
}

.tabs button {
  flex: 1;
  padding: 16px;
  font-size: 18px;
  border: none;
  background: none;
  color: white;
}

.tabs button.active {
  background: #ff74b1;
}

/* ====== TAB CONTENT ====== */
section {
  display: none;
  padding: 16px;
}

section.active {
  display: block;
}

/* ====== FORM ELEMENTS ====== */
input,
select,
button {
  width: 100%;
  padding: 12px 16px;
  font-size: 18px;
  margin: 6px 0;
  border-radius: 14px;
  border: 2px solid #ffd6ec;
  background: white;
}

/* ====== GLOBAL BUTTON STYLE ====== */
button {
  font-weight: bold;
  border: none;
  transition: transform .1s;
  box-shadow: 0 4px 10px rgba(0,0,0,.15);
}

button:active {
  transform: scale(.96);
}

/* ====== BUTTON COLORS ====== */
button.primary,
.practice,
#startButton {
  background:#ff4fa8;
  color:white;
}

/* xanh l√° ‚Äì ho√†n th√†nh */
#finishButton {
  background:#2ecc71;
  color:white;
  display:none;
}

/* xanh d∆∞∆°ng ‚Äì th√™m b√†i */
button.add {
  background:#6fa8ff;
  color:white;
}

/* n√∫t nh·∫π ‚Äì qua c√¢u ti·∫øp theo */
.nextBtnSoft,
#nextButton {
  background:#dddddd;
  color:#555;
  border:1px solid #aaa;
  box-shadow:none;
}

/* n√∫t x√≥a d·ªØ li·ªáu ‚Äî c·ªë t√¨nh kh√¥ng n·ªïi b·∫≠t */
button.delete-all {
  background:#f1f1f1;
  color:#555;
  border:1px solid #ccc;
  box-shadow:none;
  font-size:16px;
  padding:8px 10px;
}

/* ====== LABEL ====== */
label {
  font-size: 20px;
  color: #ff2f92;
  font-weight: bold;
}

/* checkbox l·ªõn */
#enableTimer {
  width: 26px;
  height: 26px;
}

/* ====== CREATED EXERCISE BLOCK ====== */
.exercise {
  background: white;
  padding: 18px;
  border-radius: 18px;
  box-shadow: 0 4px 10px rgba(255, 105, 180, 0.25);
  margin-bottom: 16px;
  border: 2px dashed #ffb6e6;
}

/* ====== QUIZ CONTAINER ====== */
.quiz-container {
  width: 100%;
  min-height: 300px;
  display: flex;
  justify-content: center;
  align-items: center;
}

/* CARD TRANSITION EFFECT */
.exercise-card {
  width: 100%;
  max-width: 700px;
  padding: 22px;
  border-radius: 24px;
  background: #ffffff;
  box-shadow: 0 6px 16px rgba(255, 105, 180, .25);
  opacity: .3;
  transform: scale(.95);
  transition: .4s;
}

.exercise-card.show {
  opacity: 1;
  transform: scale(1);
}

/* ====== QUESTION TEXT ====== */
.questionText {
  font-size: 46px;
  font-weight: 900;
  text-align: center;
  color: #ff2f92;
  margin-bottom: 16px;
}

/* ====== ANSWERS ====== */
.answers {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 14px;
}

.answers button {
  font-size: 28px;
  padding: 20px 10px;
  border-radius: 20px;
  background:#fff3fb;
  border:3px solid #ff8fd6;
}

.answers button.correct {
  background:#b7ffb7;
  border-color:#00b341;
}

.answers button.wrong {
  background:#ffbaba;
  border-color:#ff0000;
}

/* ====== FINAL RESULT BLOCK ====== */
.bigResultBox {
  margin-top: 20px;
  padding: 25px;
  border-radius: 22px;
  background: #fff2fb;
  box-shadow: 0 6px 16px rgba(255, 105, 180, 0.3);
}

.bigResultTitle {
  font-size: 40px;
  text-align: center;
  font-weight: 900;
  color: #ff2f92;
  margin-bottom: 16px;
}

.bigResultStats {
  display: flex;
  justify-content: center;
  gap: 20px;
  flex-wrap: wrap;
  margin-bottom: 20px;
}

.bigCorrect {
  background: #e8ffec;
  border: 3px solid #2fb15a;
  color: #0a6b2b;
  font-size: 26px;
  padding: 12px 18px;
  border-radius: 18px;
}

.bigWrong {
  background: #ffe8e8;
  border: 3px solid #ff4d4d;
  color: #8b0000;
  font-size: 26px;
  padding: 12px 18px;
  border-radius: 18px;
}

/* ====== RESULT LIST ====== */
.resultList {
  font-size: 24px;
  line-height: 1.6;
}

.resultItemCorrect {
  color: #0a6b2b;
  font-weight: bold;
}

.resultItemWrong {
  color: #8b0000;
  font-weight: bold;
}
</style>


</head>

<body>

  <div class="tabs">
    <button class="active" onclick="showTab(0)">‚úèÔ∏è T·∫°o b√†i to√°n</button>
    <button onclick="showTab(1)">üéØ B·∫Øt ƒë·∫ßu l√†m b√†i</button>
  </div>

  <!-- ===== TAB 1: T·∫°o b√†i to√°n ===== -->
  <section class="active">
    <h3>Nh·∫≠p ph√©p to√°n</h3>

    <input id="singleInput" placeholder="V√≠ d·ª•: 3+4 ho·∫∑c 10-2" />

    <button class="practice" onclick="addSingleExercise()">Th√™m b√†i to√°n</button>
    <button onclick="clearAllExercises()" class="delete-all">
      ‚ùå X√≥a t·∫•t c·∫£ b√†i to√°n ƒë√£ l∆∞u
    </button>

    <div id="addedCount"></div>


    <div id="addMsg" style="color:green;display:none;">ƒê√£ th√™m b√†i to√°n ‚úîÔ∏è</div>


    <hr>
    <h3>üìö Danh s√°ch b√†i ƒë√£ t·∫°o</h3>
    <ul id="list"></ul>

  </section>

  <!-- ===== TAB 2: L√†m b√†i ===== -->
  <section>
    <h2>üéØ B√© l√†m b√†i t·∫≠p</h2>


    <button id="startButton" class="practice" onclick="startPractice()">‚ñ∂Ô∏è B·∫Øt ƒë·∫ßu</button>

    <div id="practiceArea"></div>

    <button id="finishButton" onclick="finishQuiz()">Ho√†n th√†nh</button>
    <div id="resultDisplay"></div>

  </section>


  <script>

    // ====== D·ªÆ LI·ªÜU ======
    let exercises = JSON.parse(localStorage.getItem("exercises") || "[]");
    let wrongList = [];
    const soundCorrect = new Audio("Sound/Corect.mp3");
    const soundWrong = new Audio("Sound/Wrong.mp3");
    const applauseSound = new Audio("Sound/Clap.mp3");
    const fireworkSound = new Audio("Sound/Fireworks.mp3");
    let autoNextTimer = null;
    let finalResults = new Map();

    renderList();

    // ====== TAB ======
    function showTab(i) {
      document.querySelectorAll("section").forEach((s, idx) => s.classList.toggle("active", idx === i));
      document.querySelectorAll(".tabs button").forEach((b, idx) => b.classList.toggle("active", idx === i));
    }

    // ====== TH√äM 1 PH√âP TO√ÅN ======
    function addSingleExercise() {
      const raw = document.getElementById("singleInput").value.trim();

      if (!raw) {
        alert("Vui l√≤ng nh·∫≠p ph√©p to√°n");
        return;
      }

      const text = raw.replace(/\s+/g, "");
      const match = text.match(/^(\d+)([\+\-\*\/])(\d+)$/);

      if (!match) {
        alert("V√≠ d·ª• h·ª£p l·ªá: 3+4, 6-2, 4*5, 8/2");
        return;
      }

      const a = parseInt(match[1]);
      const op = match[2];
      const b = parseInt(match[3]);

      let result;
      switch (op) {
        case "+": result = a + b; break;
        case "-": result = a - b; break;
        case "*": result = a * b; break;
        case "/": result = Math.floor(a / b); break;
      }

      exercises.push({
        a, b, op, result,
        userAnswer: null
      });

      localStorage.setItem("exercises", JSON.stringify(exercises));

      document.getElementById("singleInput").value = "";
      document.getElementById("addedCount").textContent = "ƒê√£ th√™m 1 b√†i to√°n";
      renderList();
    }

    // ====== DANH S√ÅCH B√ÄI TO√ÅN ======
    function renderList() {
      const listBox = document.getElementById("list");

      if (!exercises.length) {
        listBox.innerHTML = "<li>Ch∆∞a c√≥ b√†i to√°n n√†o</li>";
        return;
      }

      listBox.innerHTML = "";

      exercises.forEach(ex => {
        const li = document.createElement("li");
        li.textContent = `${ex.a} ${ex.op} ${ex.b} = ?`;
        listBox.appendChild(li);
      });
    }


    // ====== B·∫ÆT ƒê·∫¶U L√ÄM B√ÄI ======
    let timerInterval = null;
    let remainingSeconds = 0;

    let currentIndex = 0;
    let mainQueue = [];
    let retryQueue = [];
    let quizFinished = false;

    function startPractice() {

      if (!exercises.length) {
        alert("Ch∆∞a c√≥ b√†i to√°n n√†o");
        return;
      }

      quizFinished = false;
      currentIndex = 0;
      retryQueue = [];

      // t·∫°o h√†ng ƒë·ª£i ch√≠nh
      mainQueue = exercises.map(x => ({
        ...x,
        options: randomAnswers(x.result),
        userAnswer: null,
        repeated: false
      }));

      // UI
      startButton.style.display = "none";
      finishButton.style.display = "none";


      resultDisplay.innerHTML = "";
      practiceArea.innerHTML = "";

      renderCurrentQuestion();
    }


    function randomAnswers(correct) {
      let set = new Set([correct]);

      while (set.size < 4) {
        let v = correct + Math.floor(Math.random() * 11) - 5;
        if (v < 0) continue;
        set.add(v);
      }

      return Array.from(set).sort(() => Math.random() - 0.5);
    }

    function renderCurrentQuestion() {

      if (currentIndex >= mainQueue.length) {

        // xong l∆∞·ª£t ƒë·∫ßu ‚Üí l√†m l·∫°i c√¢u sai
        if (retryQueue.length === 0) {
          finishQuiz();
          return;
        }

        mainQueue = retryQueue;
        retryQueue = [];
        currentIndex = 0;
      }

      const ex = mainQueue[currentIndex];

      practiceArea.innerHTML = `
  <div class="quiz-container">
    <div id="card" class="exercise-card">

      <div class="questionText">
        ${ex.a} ${ex.op} ${ex.b} = ?
      </div>

      <div id="answerBox" class="answers"></div>

      <div id="nextBtnBox" style="margin-top:20px;text-align:center;">
        <button id="nextButton" onclick="skipQuestion()" style="padding:10px 18px;font-size:20px;">
          ‚û°Ô∏è Qua c√¢u ti·∫øp theo
        </button>
      </div>

    </div>
  </div>
`;



      const card = document.getElementById("card");
      setTimeout(() => card.classList.add("show"), 10);

      const answerBox = document.getElementById("answerBox");

      const options = randomAnswers(ex.result);

      options.forEach(v => {
        const btn = document.createElement("button");
        btn.textContent = v;

        btn.onclick = () => {

          if (quizFinished) return;

          ex.userAnswer = v;

          // kh√≥a t·∫•t c·∫£ n√∫t
          [...answerBox.children].forEach(b => {
            b.disabled = true;
          });

          // ƒë√∫ng
          if (v === ex.result) {
            btn.classList.add("correct");
            soundCorrect.play();
            finalResults.set(ex, true); // ghi ƒë√∫ng
          }
          // sai
          else {

            btn.classList.add("wrong");
            soundWrong.play();

            // ch·ªâ th√™m l·∫°i 1 l·∫ßn
            if (!ex.repeated) {
              ex.repeated = true;
              retryQueue.push(ex);
            }

            finalResults.set(ex, false); // ghi sai
          }

          setAutoNext();
        };

        answerBox.appendChild(btn);
      });

      // ·∫®n n√∫t Qua c√¢u ti·∫øp theo n·∫øu l√† c√¢u cu·ªëi
      const nextButton = document.getElementById("nextButton");

      if (currentIndex >= mainQueue.length - 1) {
        nextButton.style.display = "none";
      }

    }


    function finishQuiz() {

      clearInterval(timerInterval);

      document.getElementById("finishButton").style.display = "none";
      document.getElementById("startButton").style.display = "inline-block";

      let correctCount = 0;
      let wrongCount = 0;
      let wrongList = [];

      finalResults.forEach(v => {
        if (v) correctCount++;
        else wrongCount++;
      });

      applauseSound.play();
      fireworkSound.play();

      resultDisplay.innerHTML = `
    <div class="bigResultBox">

      <div class="bigResultTitle">
        üéâ B√© ƒë√£ ho√†n th√†nh b√†i l√†m!
      </div>

      <div class="bigResultStats">
        <div class="bigCorrect">
          ‚úÖ ƒê√∫ng: ${correctCount} / ${exercises.length}
        </div>

        <div class="bigWrong">
          ‚ùå Sai: ${wrongCount}
        </div>
      </div>
    </div>
  `;
    }

    function skipQuestion() {
      if (quizFinished) return;

      clearTimeout(autoNextTimer); // h·ªßy h·∫πn c≈©

      currentIndex++;
      renderCurrentQuestion();     // t·∫°o h·∫πn m·ªõi b√™n trong
    }
    function setAutoNext() {
      clearTimeout(autoNextTimer);

      autoNextTimer = setTimeout(() => {
        currentIndex++;
        renderCurrentQuestion();
      }, 5000);
    }
    function clearAllExercises() {
      if (!confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a to√†n b·ªô b√†i to√°n kh√¥ng?")) return;

      exercises = [];
      localStorage.removeItem("exercises");
      renderList();
      document.getElementById("addedCount").textContent = "";
    }

  </script>



</body>

</html>