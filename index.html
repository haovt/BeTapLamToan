<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>T·∫≠p L√†m To√°n Cho B√©</title>


<style>
body{
  margin:0;
  font-family: "Comic Sans MS", system-ui, sans-serif;
  background:#fff0f6; /* h·ªìng nh·∫°t n·ªÅn */
}

/* Tabs ƒë·∫ßu trang */
.tabs{
  display:flex;
  background:#ff9ac4; /* h·ªìng pastel */
}

.tabs button{
  flex:1;
  padding:16px;
  font-size:18px;
  border:none;
  background:none;
  color:white;
}

.tabs button.active{
  background:#ff74b1; /* h·ªìng ƒë·∫≠m h∆°n */
}

/* N·ªôi dung tab */
section{
  display:none;
  padding:16px;
}

section.active{
  display:block;
}

/* Input ‚Äì bo g√≥c tr√≤n */
input,select,button{
  width:100%;
  padding:14px;
  font-size:18px;
  margin:6px 0;
  border-radius:14px;
  border:2px solid #ffd6ec;
  background:white;
}

/* Khung b√†i t·∫≠p */
.exercise{
  background:white;
  padding:18px;
  border-radius:18px;
  box-shadow:0 4px 10px rgba(255,105,180,0.25);
  margin-bottom:16px;
  border: 2px dashed #ffb6e6; /* vi·ªÅn d·ªÖ th∆∞∆°ng */
}

/* √î ƒë√°p √°n */
.answers{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(120px,1fr));
  gap:10px;
}

.answers button{
  font-size:20px;
  font-weight:bold;
  background:#ffe8f5;
  border:2px solid #ffb6e6;
}

/* N√∫t ch√≠nh */

button.primary{
  background:#ff85c0;  /* h·ªìng d√¢u */
  color:white;
  border:none;
}

button.practice{
  background:#7b6cff; /* t√≠m pastel */
  color:white;
  border:none;
}

/* N√∫t b·∫Øt ƒë·∫ßu ‚Äì xanh d∆∞∆°ng pastel */
#startButton {
  background-color: #6fa8ff;
  color:white;
}

/* N√∫t ho√†n th√†nh ‚Äì xanh l√° pastel */
#finishButton {
  background-color: #8be28b;
  color:white;
  display:none;
}

/* Khi ƒëang ch·ªçn t·∫°m th·ªùi */
.selected{
  background:#fff3cd !important; /* v√†ng pastel */
}

/* k·∫øt qu·∫£ ƒë√∫ng sai */
.correct{
  background:#d8ffd8 !important;
  border:2px solid #3bbf5c !important;
}

.wrong{
  background:#ffd6d6 !important;
  border:2px solid #ff4d4d !important;
}

/* Checkbox l·ªõn */
#enableTimer {
  width: 26px;
  height: 26px;
}

/* ch·ªØ label d·ªÖ th∆∞∆°ng */
label {
  font-size: 20px;
  color:#ff2f92;
  font-weight:bold;
}

/* N√∫t chung */
button {
  border-radius: 16px;
  padding: 12px 20px;
  font-size: 17px;
  font-weight: bold;
  border:none;
  transition: transform .1s;
}

button:active{
  transform: scale(.96);
}

/* H·ªôp k·∫øt qu·∫£ */
.resultBox {
  margin-top: 15px;
  padding: 20px;
  border-radius: 18px;
  background: #fff7fd;
  box-shadow: 0 0 12px rgba(255,105,180,0.3);
  text-align: center;
}

.resultTitle {
  font-size: 30px;
  font-weight: bold;
  color:#ff2f92;
  margin-bottom: 12px;
}

.resultStats {
  display: flex;
  justify-content: center;
  gap: 20px;
  flex-wrap: wrap;
}

.statItem {
  font-size: 26px;
  font-weight: bold;
  padding: 12px 20px;
  border-radius: 14px;
  min-width: 200px;
}

.correctStat {
  background: #e8ffed;
  border: 2px solid #2fb15a;
  color: #0b6b2b;
}

.wrongStat {
  background: #ffeaea;
  border: 2px solid #ff3b3b;
  color: #9b0000;
}

#clearExercisesBtn {
  background-color: #e74c3c;
  color: white;
  padding: 8px 14px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  margin-left: 10px;
}

#clearExercisesBtn:hover {
  opacity: .8;
}
/* Bao v√πng n√∫t + label tr·∫°ng th√°i */
.add-exercise-row {
  display: flex;
  align-items: center;      /* canh gi·ªØa theo chi·ªÅu d·ªçc */
  gap: 12px;                /* kho·∫£ng c√°ch gi·ªØa n√∫t v√† text */
  margin-top: 8px;
}

/* N√∫t b·∫•m nh√¨n c√¢n ƒë·ªëi h∆°n */
button {
  border-radius: 10px;
  padding: 8px 14px;
}

</style>

</head>

<body>

<div class="tabs">
  <button class="active" onclick="showTab(0)">‚úèÔ∏è T·∫°o b√†i to√°n</button>
  <button onclick="showTab(1)">üéØ B·∫Øt ƒë·∫ßu l√†m b√†i</button>
</div>

<!-- ===== TAB 1: T·∫°o b√†i to√°n ===== -->
<section class="active">
<h2>‚úèÔ∏è T·∫°o b√†i to√°n cho b√©</h2>

<label>S·ªë th·ª© nh·∫•t</label>
<input type="number" id="n1" value="1">

<label>S·ªë th·ª© hai</label>
<input type="number" id="n2" value="1">

<label>Ph√©p to√°n</label>
<select id="op">
  <option value="+">C·ªông (+)</option>
  <option value="-">Tr·ª´ (-)</option>
  <option value="*">Nh√¢n (√ó)</option>
</select>

<div class="add-exercise-row">
<button class="primary" onclick="addExercise()">‚ûï Th√™m b√†i to√°n</button>

<button id="clearExercisesBtn">X√≥a t·∫•t c·∫£ ph√©p t√≠nh</button>
</div>



<div id="addMsg" style="color:green;display:none;">ƒê√£ th√™m b√†i to√°n ‚úîÔ∏è</div>


<hr>
<h3>üìö Danh s√°ch b√†i ƒë√£ t·∫°o</h3>
<ul id="list"></ul>

</section>

<!-- ===== TAB 2: L√†m b√†i ===== -->
<section>
<h2>üéØ B√© l√†m b√†i t·∫≠p</h2>
<div id="timerDisplay" style="font-weight:bold; font-size:18px;"></div>

<label>
    <input type="checkbox" id="enableTimer">
    B·∫≠t ch·∫ø ƒë·ªô l√†m b√†i c√≥ th·ªùi gian
  </label>

  <input type="number" id="timerMinutes" placeholder="S·ªë ph√∫t" min="1" style="display:none;">

  <br><br>

<button id="startButton" class="practice" onclick="startPractice()">‚ñ∂Ô∏è B·∫Øt ƒë·∫ßu</button>

<div id="practiceArea"></div>


<button id="finishButton" onclick="finishQuiz()">Ho√†n th√†nh</button>
<div id="resultDisplay"></div>

</section>



<script>

const fireworkSound = new Audio("Sound/Fireworks.mp3");
const applauseSound = new Audio("Sound/Clap.mp3");

let exercises = JSON.parse(localStorage.getItem("math") || "[]");
let wrongList = JSON.parse(localStorage.getItem("wrong_math") || "[]");

function save(){
  localStorage.setItem("math", JSON.stringify(exercises));
  localStorage.setItem("wrong_math", JSON.stringify(wrongList));
  renderList();
}

function showTab(i){
  document.querySelectorAll("section").forEach((s,idx)=>s.classList.toggle("active",idx===i));
  document.querySelectorAll(".tabs button").forEach((b,idx)=>b.classList.toggle("active",idx===i));
}

function randomAnswers(correct) {
  let set = new Set([correct]);

  while (set.size < 4) {
    let d = correct + Math.floor(Math.random() * 11) - 5;

    // ‚ùå b·ªè s·ªë √¢m
    if (d < 0) continue;

    // th√™m v√†o n·∫øu h·ª£p l·ªá
    set.add(d);
  }

  return Array.from(set).sort(() => Math.random() - 0.5);
}


/* ===== th√™m b√†i to√°n ===== */
function addExercise(){
  let a = parseInt(n1.value);
  let b = parseInt(n2.value);
  let o = op.value;

  let correct =
    o==="+" ? a+b :
    o==="-" ? a-b :
    a*b;

  exercises.push({
    a,b,o,correct
  });

  addMsg.style.display="block";
  setTimeout(()=>addMsg.style.display="none",1500);

  save();
}

/* ===== hi·ªÉn th·ªã danh s√°ch ƒë√£ t·∫°o ===== */
function renderList(){
  list.innerHTML = "";
  [...exercises].forEach(ex=>{
    let li = document.createElement("li");
    li.textContent = `${ex.a} ${ex.o} ${ex.b} = ?`;
    list.appendChild(li);
  });
}

renderList();

function startPractice() {

resultDisplay.innerHTML = "";
  wrongList = [];
  exercises.forEach(ex => {
    ex.userAnswer = null;
    ex.isCorrect = null;
  });

// x·ª≠ l√Ω th·ªùi gian
  if (enableTimer.checked) {

    let minutes = parseInt(timerMinutes.value);

    if (!minutes || minutes <= 0) {
      alert("Nh·∫≠p s·ªë ph√∫t h·ª£p l·ªá");
      return;
    }

    remainingSeconds = minutes * 60;
    updateTimerUI();

    timerInterval = setInterval(() => {
      remainingSeconds--;
      updateTimerUI();

      if (remainingSeconds <= 0) {
        clearInterval(timerInterval);
        alert("H·∫øt th·ªùi gian");
        finishQuiz();
      }
    }, 1000);
  }


  // ·∫©n n√∫t b·∫Øt ƒë·∫ßu cho ƒë·∫øn khi ho√†n th√†nh
  document.getElementById("startButton").style.display = "none";
  document.getElementById("finishButton").style.display = "inline-block";

  // ·∫©n c·∫•u h√¨nh th·ªùi gian
  document.getElementById("enableTimer").style.display = "none";
  document.getElementById("timerMinutes").style.display = "none";

  // ∆∞u ti√™n b√†i sai
  let pool = wrongList.length ? wrongList : exercises;

  practiceArea.innerHTML = "";

  pool.forEach((ex, idx) => {

    let div = document.createElement("div");
    div.className = "exercise";

    div.innerHTML = `
      <div style="font-size:24px; font-weight:bold; margin-bottom:10px;">
        ${ex.a} ${ex.o} ${ex.b} = ?
      </div>
      <div class="answers" id="ans${idx}"></div>
    `;

    let answers = randomAnswers(ex.correct);
    let area = div.querySelector(".answers");

    answers.forEach(val => {

      let btn = document.createElement("button");
      btn.textContent = val;

      btn.onclick = ()=>{

        // ‚õî kh√¥ng cho tr·∫£ l·ªùi sau khi ho√†n th√†nh
        if (quizFinished) return;

        // tr∆∞·ªõc ti√™n b·ªè ch·ªçn c≈© trong c√πng b√†i
        [...btn.parentNode.children].forEach(b=>b.classList.remove("selected"));

        // ƒë√°nh d·∫•u n√∫t ƒëang ch·ªçn
        btn.classList.add("selected");

        ex.userAnswer = val;
        };


      area.appendChild(btn);
    });

    practiceArea.appendChild(div);
  });

}

let quizFinished = false;
let timerInterval = null;
let remainingSeconds = 0;
let quizLocked = false;
function renderQuiz(list) {
  const container = document.getElementById("quizArea");
  container.innerHTML = "";
  answers = {};

  list.forEach((ex, idx) => {

    // t·∫°o khung b√†i t·∫≠p
    const wrapper = document.createElement("div");
    wrapper.className = "exercise";

    // ti√™u ƒë·ªÅ b√†i to√°n
    const title = document.createElement("div");
    title.innerHTML = `<b>${ex.a} ${ex.op} ${ex.b} = ?</b>`;
    wrapper.appendChild(title);

    // t·∫°o 4 ph∆∞∆°ng √°n
    const options = randomAnswers(ex.result);

    options.forEach(value => {
      const opt = document.createElement("div");
      opt.className = "option";
      opt.textContent = value;

      opt.onclick = () => {
        // l∆∞u ƒë√°p √°n b√© ch·ªçn
        answers[idx] = value;

        // b·ªè highlight c≈©
        wrapper.querySelectorAll(".option").forEach(o => {
          o.style.outline = "none";
        });

        // highlight ph∆∞∆°ng √°n ƒëang ch·ªçn
        opt.style.outline = "3px solid blue";
      };

      wrapper.appendChild(opt);
    });

    container.appendChild(wrapper);
  });
}


function updateTimerLabel() {
  const box = document.getElementById("timerBox");
  box.style.display = "block";

  const min = Math.floor(remainingSeconds / 60);
  const sec = remainingSeconds % 60;

  box.innerText = `‚è≥ C√≤n l·∫°i: ${min}:${sec.toString().padStart(2,"0")}`;
}


function finishQuiz() {

  clearInterval(timerInterval);

  // 1Ô∏è‚É£ ·∫®n n√∫t ho√†n th√†nh ‚Äì hi·ªán n√∫t b·∫Øt ƒë·∫ßu l·∫°i
  document.getElementById("finishButton").style.display = "none";
  document.getElementById("startButton").style.display = "inline-block";

  let correctCount = 0;
  wrongList = [];

  document.querySelectorAll(".exercise").forEach((div, idx) => {

    const ex = exercises[idx];
    const buttons = div.querySelectorAll("button");

    buttons.forEach(btn => {
      const val = parseInt(btn.textContent);

      // kh√≥a to√†n b·ªô n√∫t
      btn.disabled = true;

      // ch·ªâ x·ª≠ l√Ω n√∫t ƒë∆∞·ª£c b√© ch·ªçn
      if (ex.userAnswer === val) {

        // b·ªè m√†u v√†ng ƒë√£ ch·ªçn l√∫c l√†m b√†i
        btn.classList.remove("selected");

        // ƒë√∫ng ‚Üí xanh
        if (val === ex.correct) {
          btn.classList.add("correct");
          correctCount++;
        }
        // sai ‚Üí ƒë·ªè
        else {
          btn.classList.add("wrong");
          wrongList.push(ex);
        }
      }
    });
  });

  // l∆∞u b√†i sai
  localStorage.setItem("wrong_math", JSON.stringify(wrongList));

  // √¢m thanh ch√∫c m·ª´ng
  applauseSound.play();
    fireworkSound.play();

  // hi·ªán k·∫øt qu·∫£
resultDisplay.innerHTML = `
  <div class="resultBox">
    <div class="resultTitle">üéâ Ho√†n th√†nh b√†i l√†m!</div>

    <div class="resultStats">
      <div class="statItem correctStat">
        ‚úÖ ƒê√∫ng: <span>${correctCount}</span> / ${exercises.length}
      </div>

      <div class="statItem wrongStat">
        üîÅ Sai c·∫ßn luy·ªán th√™m: <span>${wrongList.length}</span>
      </div>
    </div>
  </div>
`;

}

document.getElementById("enableTimer").addEventListener("change", function () {
  const timerInput = document.getElementById("timerMinutes");
  timerInput.style.display = this.checked ? "inline-block" : "none";
});

function updateTimerUI() {
  const m = Math.floor(remainingSeconds / 60);
  const s = remainingSeconds % 60;

  timerDisplay.textContent =
    `‚è≥ Th·ªùi gian c√≤n l·∫°i: ${m}:${s.toString().padStart(2,"0")}`;
}

document.getElementById("clearExercisesBtn").addEventListener("click", () => {
    if (!confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a t·∫•t c·∫£ ph√©p t√≠nh?")) return;

    // 1. X√≥a d·ªØ li·ªáu trong bi·∫øn
    exercises = [];
    correctCount = 0;
    wrongList = [];

    // 2. X√≥a localStorage
    localStorage.removeItem("exercises");
    localStorage.removeItem("wrongList");
    localStorage.removeItem("quizProgress");
    localStorage.removeItem("math");
    localStorage.removeItem("wrong_math");

    
    // 3. X√≥a danh s√°ch hi·ªÉn th·ªã trong tab t·∫°o b√†i
    const exerciseList = document.getElementById("exerciseList");
    if (exerciseList) {
        exerciseList.innerHTML = "";
    }

    // 4. X√≥a danh s√°ch c√¢u h·ªèi ƒëang hi·ªÉn th·ªã (n·∫øu ƒë√£ render quiz)
    const quizContainer = document.getElementById("quizContainer");
    if (quizContainer) {
        quizContainer.innerHTML = "";
    }

    // 5. X√≥a k·∫øt qu·∫£ th·ªëng k√™
    const resultDisplay = document.getElementById("resultDisplay");
    if (resultDisplay) {
        resultDisplay.innerHTML = "";
    }

    // 6. ·∫®n n√∫t ho√†n th√†nh
    const finishBtn = document.getElementById("finishQuizBtn");
    if (finishBtn) finishBtn.style.display = "none";

    // 7. Hi·ªán n√∫t b·∫Øt ƒë·∫ßu
    const startBtn = document.getElementById("startQuizBtn");
    if (startBtn) startBtn.style.display = "inline-block";

    renderList();
    alert("ƒê√£ x√≥a t·∫•t c·∫£ ph√©p t√≠nh v√† d·ªØ li·ªáu b·ªô nh·ªõ.");
});


</script>

</body>
</html>
